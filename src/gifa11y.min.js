/*
 * Gifa11y
 * @author: Adam Chaboryk
 * @version: 1.0.5
 * @license: MIT
 */
class Gifa11y{"use strict";constructor(t){t={buttonBackground:"indigo",buttonBackgroundHover:"rebeccapurple",buttonIconColor:"white",buttonFocusColor:"#00e7ffad",buttonIconSize:"1.5rem",buttonIconFontSize:"1rem",buttonPlayIconID:"",buttonPauseIconID:"",buttonPlayIconHTML:"",buttonPauseIconHTML:"",container:"body",exclusions:"",gifa11yOff:"",inheritClasses:!0,initiallyPaused:!1,langPause:"Pause animation:",langPlay:"Play animation:",langPauseAllButton:"Pause all animations",langPlayAllButton:"Play all animations",langMissingAlt:"Missing image description.",langAltWarning:"&#9888; Error! Please add alternative text to GIF.",missingAltWarning:!0,...t};let n=[];this.initialize=()=>{this.exclusions();0===document.querySelectorAll(t.gifa11yOff).length&&(this.generateCSS(),document.addEventListener("DOMContentLoaded",(t=>{this.findGifs(),this.generateStill(),this.prepareButtons(),this.toggleEverything()}),!1))},this.exclusions=()=>{if(t.gifa11yOff.length>0){let n=t.gifa11yOff.split(",");t.gifa11yOff=".gifa11y-off, "+n.join()}else t.gifa11yOff=".gifa11y-off";if(t.exclusions.length>0){let n=t.exclusions.split(",");for(let t=0;t<n.length;t++)n[t]=n[t]+" *, "+n[t];t.exclusions=".gifa11y-ignore, "+n.join()}else t.exclusions=".gifa11y-ignore"},this.findGifs=()=>{const e=document.querySelector(t.container),a=e?Array.from(e.querySelectorAll('img[src$=".gif"]:not([src*="gifa11y-ignore"])')):[],i=e?Array.from(e.querySelectorAll(t.exclusions)):[];a.filter((t=>!i.includes(t))).forEach(((t,e)=>{n[e]=t}))},this.generateStill=()=>{function e(n){let e;if(e=n.src.split("."),e=e[e.length-1].toLowerCase(),e=e.substring(0,4),"gif"===e){const e=document.createElement("canvas");let a=parseFloat(getComputedStyle(n,null).getPropertyValue("border-left-width"))+parseFloat(getComputedStyle(n,null).getPropertyValue("border-right-width")),i=n.getAttribute("width");if(null!==i?(e.width=i,e.setAttribute("style","width:"+i+"px !important;")):0==n.clientWidth?e.width=n.naturalWidth+.5+a:e.width=n.clientWidth+.5+a,0==n.clientHeight?e.height=n.naturalHeight+.5:e.height=n.clientHeight+.5,e.setAttribute("role","img"),!0===t.inheritClasses){let t=n.getAttribute("class");null==t&&(t=""),e.setAttribute("class","gifa11y-canvas "+t)}else e.setAttribute("class","gifa11y-canvas");let o=n.getAttribute("alt");null!=o&&""!=o&&" "!=o||(o=t.langMissingAlt),e.setAttribute("aria-label",o);const l=n.src,r=window.matchMedia("(prefers-reduced-motion: reduce)");!r||r.matches||n.classList.contains("gifa11y-paused")||l.indexOf("gifa11y-paused")>-1||!0===t.initiallyPaused?(n.style.display="none",n.setAttribute("data-gifa11y-state","paused")):(e.style.display="none",n.setAttribute("data-gifa11y-state","playing"));e.getContext("2d").drawImage(n,0,0,e.width,e.height),n.after(e)}}n.forEach((t=>{t.complete?e(t):t.addEventListener("load",(()=>{e(t)}))}))},this.prepareButtons=()=>{function e(n){const e=window.matchMedia("(prefers-reduced-motion: reduce)"),a=n.nextElementSibling;let i,o,l,r,s=n.src;!e||e.matches||n.classList.contains("gifa11y-paused")||s.indexOf("gifa11y-paused")>-1||!0===t.initiallyPaused?(i=t.langPlay,r="block",l="none",o="paused"):(i=t.langPause,r="none",l="block",o="playing");let u=n.getAttribute("alt");if((null==u||""==u||" "==u)&&(u=t.langMissingAlt,!0===t.missingAltWarning)){const n=document.createElement("span");n.classList.add("gifa11y-warning"),n.innerHTML=`${t.langAltWarning}`,a.after(n)}const c=document.createElement("button");c.classList.add("gifa11y-btn"),c.setAttribute("aria-label",i+" "+u),c.setAttribute("data-gifa11y-state",o),c.setAttribute("data-gifa11y-alt",u),c.innerHTML=`<div class="gifa11y-pause-icon" aria-hidden="true" style="display: ${l}"></div><div class="gifa11y-play-icon" aria-hidden="true" style="display: ${r}"></div>`;const d=c.querySelector(".gifa11y-pause-icon"),g=c.querySelector(".gifa11y-play-icon");if(t.buttonPauseIconID.length>1){const n=document.getElementById(t.buttonPauseIconID).innerHTML;d.innerHTML=n}else t.buttonPauseIconHTML.length>1?d.innerHTML=t.buttonPauseIconHTML:d.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/></svg>';if(t.buttonPlayIconID.length>1){const n=document.getElementById(t.buttonPlayIconID).innerHTML;g.innerHTML=n}else t.buttonPlayIconHTML.length>1?g.innerHTML=t.buttonPlayIconHTML:g.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>';n.closest("a[href]")?n.closest("a[href]").insertAdjacentElement("beforebegin",c):n.insertAdjacentElement("beforebegin",c),c.addEventListener("click",(e=>{c.setAttribute("data-gifa11y-state","paused"===c.getAttribute("data-gifa11y-state")?"playing":"paused");const i=c.querySelector(".gifa11y-play-icon"),o=c.querySelector(".gifa11y-pause-icon");"paused"===c.getAttribute("data-gifa11y-state")?(n.style.display="none",a.style.display="block",i.style.display="block",o.style.display="none",c.setAttribute("aria-label",t.langPlay+" "+u)):(n.style.display="block",a.style.display="none",i.style.display="none",o.style.display="block",c.setAttribute("aria-label",t.langPause+" "+u)),e.preventDefault()}),!1)}n.forEach((t=>{t.complete?e(t):t.addEventListener("load",(()=>{e(t)}))}))},this.toggleEverything=()=>{const e=document.getElementById("gifa11y-all"),a=window.matchMedia("(prefers-reduced-motion: reduce)"),i=document.querySelector("html");null!==e&&(!a||a.matches||!0===t.initiallyPaused?(i.setAttribute("data-gifa11y-all","paused"),e.innerText=t.langPlayAllButton):(i.setAttribute("data-gifa11y-all","playing"),e.innerText=t.langPauseAllButton),e.setAttribute("disabled",!0),Promise.all(Array.from(n).filter((t=>!t.complete)).map((t=>new Promise((n=>{t.onload=t.onerror=n}))))).then((()=>{e.addEventListener("click",(()=>{const a=document.querySelector("html");a.setAttribute("data-gifa11y-all","paused"===a.getAttribute("data-gifa11y-all")?"playing":"paused");const i=a.getAttribute("data-gifa11y-all"),o=document.querySelectorAll("canvas.gifa11y-canvas"),l=document.querySelectorAll("button.gifa11y-btn");let r,s,u,c;"paused"===i?(r="block",s="none",u="paused",c=t.langPlay,e.innerText=t.langPlayAllButton):(r="none",s="block",u="playing",c=t.langPause,e.innerText=t.langPauseAllButton),n.forEach((t=>{t.style.display=s})),o.forEach((t=>{t.style.display=r})),l.forEach((t=>{let n=t.getAttribute("data-gifa11y-alt"),e=t.querySelector(".gifa11y-play-icon"),a=t.querySelector(".gifa11y-pause-icon");e.style.display=r,a.style.display=s,t.setAttribute("data-gifa11y-state",u),t.setAttribute("aria-label",c+" "+n)}))})),e.removeAttribute("disabled")})))},this.generateCSS=()=>{const n=document.createElement("style");n.innerHTML=`\n\t\t\t\tbutton.gifa11y-btn,\n\t\t\t\tspan.gifa11y-warning {\n\t\t\t\t\tall: unset;\n\t\t\t\t\tbox-sizing: border-box !important;\n\t\t\t\t}\n\t\t\t\tbutton.gifa11y-btn {\n\t\t\t\t\tbackground: ${t.buttonBackground} !important;\n\t\t\t\t\tcolor: ${t.buttonIconColor} !important;\n\t\t\t\t\tborder-radius: 50% !important;\n\t\t\t\t\tbox-shadow: 0 0 16px 0 #0000004f !important;\n\t\t\t\t\tborder: 2px solid white !important;\n\t\t\t\t\tcursor: pointer !important;\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tline-height: normal !important;\n\t\t\t\t\tmin-height: 36px !important;\n\t\t\t\t\tmin-width: 36px !important;\n\t\t\t\t\ttext-align: center !important;\n\t\t\t\t\tmargin: 12px !important;\n\t\t\t\t\tpadding: 4px !important;\n\t\t\t\t\tposition: absolute !important;\n\t\t\t\t\ttransition: all .2s ease-in-out !important;\n\t\t\t\t\tz-index: 500 !important;\n\t\t\t\t}\n\t\t\t\tbutton.gifa11y-btn:hover, button.gifa11y-btn:focus {\n\t\t\t\t\tbackground: ${t.buttonBackgroundHover} !important;\n\t\t\t\t}\n\t\t\t\tbutton.gifa11y-btn:focus {\n\t\t\t\t\tbox-shadow: 0 0 0 5px ${t.buttonFocusColor} !important;\n\t\t\t\t\toutline: 3px solid transparent;\n\t\t\t\t}\n\t\t\t\tdiv.gifa11y-play-icon i,\n\t\t\t\tdiv.gifa11y-pause-icon > i {\n\t\t\t\t\tfont-size: ${t.buttonIconFontSize} !important;\n\t\t\t\t\tpadding: 4px !important;\n\t\t\t\t\tvertical-align: middle !important;\n\t\t\t\t\tmin-width: calc(${t.buttonIconFontSize} * 1.4) !important;\n    \t\t\tmin-height: calc(${t.buttonIconFontSize} * 1.4) !important;\n\t\t\t\t}\n\t\t\t\tdiv.gifa11y-pause-icon > svg,\n\t\t\t\tdiv.gifa11y-play-icon > svg {\n\t\t\t\t\tflex-shrink: 0 !important;\n\t\t\t\t\tposition: relative !important;\n\t\t\t\t\tvertical-align: middle !important;\n\t\t\t\t\theight: ${t.buttonIconSize} !important;\n\t\t\t\t\twidth: ${t.buttonIconSize} !important;\n\t\t\t\t\t-webkit-transform: translate(0px,0px) !important;\n\t\t\t\t}\n\t\t\t\tspan.gifa11y-warning {\n\t\t\t\t\tbackground: darkred !important;\n\t\t\t\t\tcolor: white !important;\n\t\t\t\t\tpadding: 5px !important;\n\t\t\t\t\tfont-size: 1.1rem !important;\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tfont-family: Arial !important;\n\t\t\t\t\tmax-width: 450px !important;\n\t\t\t\t}\n\t\t\t\t/* Increase target size of button. */\n\t\t\t\tbutton.gifa11y-btn:before {\n\t\t\t\t\tcontent: "" !important;\n\t\t\t\t\tinset: -8.5px !important;\n\t\t\t\t\tmin-height: 50px !important;\n\t\t\t\t\tmin-width: 50px !important;\n\t\t\t\t\tposition: absolute !important;\n\t\t\t\t}\n\t\t\t\tcanvas.gifa11y-canvas {\n\t\t\t\t\tobject-fit: contain !important;\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t}\n\t\t\t\t`,document.getElementsByTagName("head")[0].appendChild(n)},this.initialize()}}